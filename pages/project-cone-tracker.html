<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Cone Tracker</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      color: #333;
    }

    header {
      background: #222;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    main {
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    form {
      display: grid;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    input, textarea, select {
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      border-radius: 5px;
      cursor: pointer;
      margin-left: 0.5rem;
    }

    .task, .question {
      border-left: 4px solid #ccc;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 5px;
      background: #f1f1f1;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .task[data-status="todo"] { border-color: orange }
    .task[data-status="in-progress"] { border-color: dodgerblue }
    .task[data-status="done"] { border-color: green }
    .question.resolved { opacity: 0.6; text-decoration: line-through }

    .cone {
      width: 100%;
      height: 200px;
      background: linear-gradient(to right, transparent, #ddd, transparent);
      position: relative;
      margin-bottom: 2rem;
      overflow: hidden;
    }

    .dot {
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .dot.todo { background: orange }
    .dot.in-progress { background: dodgerblue }
    .dot.done { background: green }

    .dot.question {
      width: 2px;
      height: 2px;
      border-radius: 0;
      transform: rotate(45deg);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: rotate(45deg) scale(1); opacity: 1; }
      50% { transform: rotate(45deg) scale(1.15); opacity: 0.5; }
    }
      50% { transform: rotate(45deg) scale(1.4); opacity: 0.5; }
    }

    #parking-lot {
      margin-top: 3rem;
    }

    .task-section {
      margin-bottom: 2rem;
    }

    .task-section h3 {
      margin-bottom: 1rem;
      border-bottom: 2px solid #ccc;
    }
    .status-options, .task-status-group {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }

  .status-options label, .task-status-group label {
    padding: 0.4rem 1rem;
    border: 1px solid #ccc;
    border-radius: 999px;
    background-color: #f0f0f0;
    cursor: pointer;
    user-select: none;
    transition: all 0.2s ease;
  }

  .status-options input[type="radio"], .task-status-group input[type="radio"] {
    display: none;
  }

  .status-options input[type="radio"]:checked + label,
  .task-status-group input[type="radio"]:checked + label {
    background-color: #007bff;
    color: white;
    border-color: #007bff;
  }
</style>
</head>
<body>
  <header>
    <h1>Project Cone Tracker</h1>
  </header>
  <main>
    <div class="cone" id="cone"></div>
    <form id="task-form">
      <input type="text" id="title" placeholder="Task title" required>
      <textarea id="note" placeholder="Task notes"></textarea>
      <div id="status" class="status-options">
        <label><input type="radio" name="status" value="todo" checked> To Do</label>
        <label><input type="radio" name="status" value="in-progress"> In Progress</label>
        <label><input type="radio" name="status" value="done"> Done</label>
      </div>
      <button type="submit">Add Task</button>
    </form>
    <div id="task-list"></div>

    <section id="parking-lot">
      <h2>Parking Lot (Questions & Unknowns)</h2>
      <form id="question-form">
        <input type="text" id="question-input" placeholder="Enter question or unknown..." required>
        <button type="submit">Add Question</button>
      </form>
      <div id="question-list"></div>
    </section>
  </main>
  <script>
    class Task {
      constructor(title, note, status) {
        this.title = title
        this.note = note
        this.status = status
      }

      render(index, updateCallback, editCallback) {
        const div = document.createElement('div')
        div.className = 'task'
        div.dataset.status = this.status

        const titleEl = document.createElement('h3')
        titleEl.contentEditable = true
        titleEl.textContent = this.title
        titleEl.addEventListener('blur', () => editCallback(index, 'title', titleEl.textContent))

        const noteEl = document.createElement('p')
        noteEl.contentEditable = true
        noteEl.textContent = this.note
        noteEl.addEventListener('blur', () => editCallback(index, 'note', noteEl.textContent))

        const label = document.createElement('label')
        label.textContent = 'Status: '
        const statusOptions = ['todo', 'in-progress', 'done']
        const container = document.createElement('div')
        statusOptions.forEach(option => {
          const radio = document.createElement('input')
          radio.type = 'radio'
          radio.name = `status-${index}`
          radio.value = option
          radio.id = `status-${index}-${option}`
          if (this.status === option) radio.checked = true
          radio.addEventListener('change', e => {
            this.status = e.target.value
            updateCallback(index, this.status)
          })
          const labelEl = document.createElement('label')
          labelEl.htmlFor = radio.id
          labelEl.textContent = option.replace('-', ' ')
          container.appendChild(radio)
          container.appendChild(labelEl)
        })
        container.classList.add('task-status-group')
        label.appendChild(container)

        div.appendChild(titleEl)
        div.appendChild(noteEl)
        div.appendChild(label)

        return div
      }
    }

    const randomColor = () => `hsl(${Math.floor(Math.random()*360)}, 70%, 60%)`

    class ProjectCone {
      constructor() {
        this.tasks = []
        this.questions = []
        this.form = document.getElementById('task-form')
        this.list = document.getElementById('task-list')
        this.cone = document.getElementById('cone')
        this.questionForm = document.getElementById('question-form')
        this.questionList = document.getElementById('question-list')
        this.load()
        this.init()
      }

      init() {
        this.form.addEventListener('submit', e => {
          e.preventDefault()
          this.addTask()
        })

        this.questionForm.addEventListener('submit', e => {
          e.preventDefault()
          this.addQuestion()
        })
      }

      addTask() {
        const title = document.getElementById('title').value
        const note = document.getElementById('note').value
        const status = document.querySelector('input[name="status"]:checked').value
        const task = new Task(title, note, status)
        this.tasks.push(task)
        this.save()
        this.renderTasks()
        this.renderQuestions()
        this.renderCone()
        this.form.reset()
      }

      addQuestion() {
        const input = document.getElementById('question-input')
        const question = input.value.trim()
        if (question.length > 0) {
          this.questions.push({ text: question, resolved: false })
          this.save()
          this.renderQuestions()
          this.renderCone()
          input.value = ''
        }
      }

      toggleResolved(index) {
        this.questions[index].resolved = !this.questions[index].resolved
        this.save()
        this.renderQuestions()
        this.renderCone()
      }

      deleteQuestion(index) {
        this.questions.splice(index, 1)
        this.save()
        this.renderQuestions()
        this.renderCone()
      }

      updateStatus(index, newStatus) {
        this.tasks[index].status = newStatus
        this.save()
        this.renderTasks()
        this.renderCone()
      }

      editTask(index, field, value) {
        this.tasks[index][field] = value
        this.save()
        this.renderCone()
      }

      renderTasks() {
        this.list.innerHTML = ''
        const grouped = {
          'in-progress': [],
          'todo': [],
          'done': []
        }
        this.tasks.forEach((t, i) => {
          grouped[t.status].push(t.render(i, this.updateStatus.bind(this), this.editTask.bind(this)))
        })
        for (const status of ['in-progress', 'todo', 'done']) {
          if (grouped[status].length > 0) {
            const section = document.createElement('div')
            section.className = 'task-section'
            const title = document.createElement('h3')
            title.textContent = status === 'in-progress' ? 'In Progress' : status === 'todo' ? 'To Do' : 'Done'
            section.appendChild(title)
            grouped[status].forEach(taskEl => section.appendChild(taskEl))
            this.list.appendChild(section)
          }
        }
      }

      renderQuestions() {
        this.questionList.innerHTML = ''
        const sortedQuestions = [...this.questions].sort((a, b) => a.resolved - b.resolved)
        sortedQuestions.forEach((q, i) => {
          const div = document.createElement('div')
          div.className = 'question' + (q.resolved ? ' resolved' : '')
          const span = document.createElement('span')
          span.textContent = q.text
          const resolveBtn = document.createElement('button')
          resolveBtn.textContent = q.resolved ? 'Unresolve' : 'Resolve'
          resolveBtn.addEventListener('click', () => this.toggleResolved(this.questions.indexOf(q)))
          const deleteBtn = document.createElement('button')
          deleteBtn.textContent = 'Delete'
          deleteBtn.addEventListener('click', () => this.deleteQuestion(this.questions.indexOf(q)))
          div.appendChild(span)
          div.appendChild(resolveBtn)
          div.appendChild(deleteBtn)
          this.questionList.appendChild(div)
        })
      }

      renderCone() {
        this.cone.innerHTML = ''
        const taskOrderMap = { 'todo': 0, 'in-progress': 1, 'done': 2 }
        const taskGroups = [[], [], []]
        this.tasks.forEach(task => taskGroups[taskOrderMap[task.status]].push(task))

        const total = this.tasks.length
        let index = 0
        taskGroups.forEach((group, groupIndex) => {
          group.forEach(task => {
            const dot = document.createElement('div')
            dot.className = `dot ${task.status}`
            const x = (index + 1) / (total + 1)
            const y = (groupIndex + 1) / 4
            dot.style.left = `${x * 100}%`
            dot.style.top = `${y * 100}%`
            this.cone.appendChild(dot)
            index++
          })
        })

        this.questions.forEach(q => {
          if (!q.resolved) {
            const dot = document.createElement('div')
            dot.className = 'dot question'
            dot.style.left = `${Math.random() * 100}%`
            dot.style.top = `${Math.random() * 100}%`
            dot.style.background = randomColor()
            this.cone.appendChild(dot)
          }
        })
      }

      save() {
        localStorage.setItem('project-tasks', JSON.stringify(this.tasks))
        localStorage.setItem('project-questions', JSON.stringify(this.questions))
      }

      load() {
        const savedTasks = localStorage.getItem('project-tasks')
        if (savedTasks) {
          const parsed = JSON.parse(savedTasks)
          this.tasks = parsed.map(t => new Task(t.title, t.note, t.status))
        }
        const savedQuestions = localStorage.getItem('project-questions')
        if (savedQuestions) {
          this.questions = JSON.parse(savedQuestions)
        }
        this.renderTasks()
        this.renderQuestions()
        this.renderCone()
      }
    }

    new ProjectCone()
  </script>
</body>
</html>
